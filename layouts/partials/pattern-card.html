{{/*
  pattern-card.html

  Renders a pattern as a visual card for the patterns grid.

  Usage: {{ partial "pattern-card.html" (dict "pattern" . "index" $i) }}

  Context:
    .pattern  — the pattern page object
    .index    — zero-based position in the grid (optional)

  Note: Mini constellation SVG deferred to post-Phase 0 (backoffice scope).
        Confidence bar serves as the primary visual indicator.
*/}}

{{- $pattern := .pattern -}}
{{- $index := .index | default 0 -}}

<article class="border border-[var(--border)] rounded-[3px] bg-[var(--surface-elevated)] p-5 hover:border-[var(--border-subtle)] transition-colors">
  <a href="{{ $pattern.RelPermalink }}" class="block group focus:outline-none focus:ring-2 focus:ring-[var(--text-tertiary)] rounded-[2px]">

    {{/* Top row: title + meta */}}
    <div class="flex items-start justify-between gap-3 mb-2">
      <h3 class="font-heading text-[16px] font-bold leading-[1.3] text-[var(--text-primary)] group-hover:text-[var(--text-primary)]">
        {{ $pattern.Title }}
      </h3>
      {{/* Meta: blockCount · timespan · trajectory */}}
      <div class="font-mono text-[11px] text-[var(--text-tertiary)] shrink-0 text-right leading-[1.5]">
        {{- with $pattern.Params.blockCount -}}
          <span>{{ . }} blocks</span>
        {{- end -}}
        {{- with $pattern.Params.timespan -}}
          {{- if or $pattern.Params.blockCount $pattern.Params.trajectory -}}<span class="mx-1">·</span>{{- end -}}
          <span>{{ . }}</span>
        {{- end -}}
        {{- with $pattern.Params.trajectory -}}
          {{- if or $pattern.Params.blockCount $pattern.Params.timespan -}}<span class="mx-1">·</span>{{- end -}}
          <span style="color: var(--convergence);">{{ . }}</span>
        {{- end -}}
      </div>
    </div>

    {{/* Confidence bar */}}
    {{- with $pattern.Params.confidence -}}
      <div class="mb-3">
        <span class="font-mono text-[10px] uppercase tracking-[0.08em] text-[var(--text-tertiary)] block mb-1">Confidence</span>
        {{ partial "confidence-bar.html" (dict "confidence" .) }}
      </div>
    {{- end -}}

    {{/* Description excerpt — auto-truncate to ~3 lines (42ch max) */}}
    {{- with $pattern.Params.description -}}
      <p class="font-body text-[13px] leading-[1.6] text-[var(--text-secondary)] mt-2 line-clamp-3">
        {{ . }}
      </p>
    {{- end -}}

  </a>
</article>
